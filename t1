box::use(shiny[...],
         RSQLite[...])


#'@export
ui <- function(id) {
  ns=NS(id)
  fluidPage(
   
      titlePanel("User Authentication App"),
      mainPanel(
        h3("Let' verify you"),
        p("Use the buttons to create an account or log in.")
      )
    )
    
  
}

#'@export
server <- function(id) {
  moduleServer(id, function(input, output, session) {
  
    
    db <- dbConnect(SQLite(), "users.db")
    
   
    dbExecute(db, "CREATE TABLE IF NOT EXISTS users (
  id INTEGER PRIMARY KEY,
  username TEXT UNIQUE,
  name TEXT,
  password TEXT,
  designation TEXT
)")
    
    
  showModal(modalDialog(
    title = "Welcome",
    actionButton("create_account", "Create Account"),
    actionButton("login_btn", "Login"),
    footer = NULL
  ))
  

  observeEvent(input$create_account, {
    showModal(modalDialog(
      title = "Create Account",
      textInput("new_username", "Username"),
      textInput("name", "Name"),
      passwordInput("new_password", "Password"),
      selectInput("designation", "Designation", choices = c("Employee", "Manager", "Director")),
      footer = tagList(
        modalButton("Cancel"),
        actionButton("create", "Create Account")
      )
    ))
  })
  
 
  observeEvent(input$create, {
    
    new_username <- input$new_username
    name <- input$name
    new_password <- input$new_password
    designation <- input$designation
   
    tryCatch({
      dbExecute(db, "INSERT INTO users (username, name, password, designation) VALUES (?, ?, ?, ?)",
                params = list(new_username, name, new_password, designation))
      
      
      showModal(modalDialog(
        title = "Account Created Successfully",
        easyClose = TRUE,
        footer = NULL
      ))
      
      Sys.sleep(1)  
      removeModal() 
      showModal(modalDialog(
        title = "Login",
        actionButton("login_coordinator", "Login as Coordinator"),
        actionButton("login_contributor", "Login as Contributor"),
        footer = NULL
      ))
      
    }, error = function(e) {
      showModal(modalDialog(
        title = "Error",
        "Username already exists!",
        easyClose = TRUE,
        footer = NULL
      ))
    })
  })
  

  observeEvent(input$login_btn, {
    showModal(modalDialog(
      title = "Login",
      actionButton("login_coordinator", "Login as Coordinator"),
      actionButton("login_contributor", "Login as Contributor"),
      footer = NULL
    ))
  })
  

  observeEvent(input$login_coordinator, {
    showModal(modalDialog(
      title = "Login",
      textInput("username", "Username"),
      passwordInput("password", "Password"),
      footer = tagList(
        modalButton("Cancel"),
        actionButton("login_action", "Login as Coordinator")
      )
    ))
    session$userData$role <- "coordinator"
  })
  
  observeEvent(input$login_contributor, {
    showModal(modalDialog(
      title = "Login",
      textInput("username", "Username"),
      passwordInput("password", "Password"),
      footer = tagList(
        modalButton("Cancel"),
        actionButton("login_action", "Login as Contributor")
      )
    ))
    session$userData$role <- "contributor"
  })

  observeEvent(input$login_action, {
    username <- input$username
    password <- input$password
    role <- session$userData$role
    

    user <- dbGetQuery(db, "SELECT * FROM users WHERE username = ? AND password = ?", params = list(username, password))
    
    if (nrow(user) == 1) {
      designation <- user$designation
      
      if (role == "coordinator") {
        
        if (designation %in% c("Manager", "Director")) {
          removeModal()
          showModal(modalDialog(
            title = "Success",
            "Successfully logged in as Coordinator",
            easyClose = TRUE,
            footer = NULL
          ))
        } else {
          showModal(modalDialog(
            title = "Error",
            "Only users with Manager or Director designation can log in as Coordinator",
            easyClose = TRUE,
            footer = NULL
          ))
        }
      } else if (role == "contributor") {
  
        removeModal()
        showModal(modalDialog(
          title = "Success",
          "Successfully logged in as Contributor",
          easyClose = TRUE,
          footer = NULL
        ))
      }
    } else {
      showModal(modalDialog(
        title = "Error",
        "Invalid username or password",
        easyClose = TRUE,
        footer = NULL
      ))
    }
  })
})}
